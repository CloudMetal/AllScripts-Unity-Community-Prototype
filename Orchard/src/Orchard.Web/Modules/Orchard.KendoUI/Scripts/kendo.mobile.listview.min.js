/*
* Kendo UI Complete v2012.2.913 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
;(function(a,b){function L(a){if(!!a.children("input[type=checkbox],input[type=radio]").length){var b=a.parent();if(b.contents().not(a).not(function(){return this.nodeType==3})[0])return;a.addClass("km-listview-label")}}function K(a){var b=a.parent(),d=a.add(b.children(c.roleSelector("detailbutton"))),e=b.contents().not(d).not(H);e.length||(a.addClass("km-listview-link").attr(c.attr("role"),"listview-link"),I(a,m(b,"icon")))}function J(a){I(a,m(a,"icon"))}function I(a,b){b&&a.prepend('<span class="km-icon km-'+b+'"/>')}function H(){return this.nodeType===d.TEXT_NODE&&this.nodeValue.match(F)}var c=window.kendo,d=window.Node,e=c.mobile,f=e.ui,g=c.support,h=c.data.DataSource,i=f.Widget,j=".km-list > li",k=".km-list > li > .km-listview-link, .km-list > li > .km-listview-label",l=a.proxy,m=c.attrValue,n="km-group-title",o="km-state-active",p='<div class="'+n+'"><div class="km-text"></div></div>',q=c.template('<li><div class="'+n+'"><div class="km-text">#= this.headerTemplate(data) #</div></div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),r='<div class="km-listview-wrapper" />',s=".kendoMobileListView",t=g.mouseup,u=t+s,v=g.mousedown,w=v+s,x=g.mousemove+s,y=g.mousecancel+s,z="lastPageReached",A="click",B=A+s,C="change",D="requestStart",E="function",F=/^\s+$/,G=/button/,M=i.extend({init:function(b,d){var e=this;i.fn.init.call(e,b,d),d=e.options,e.element.on([w,u,x,y].join(" "),k,e._toggleItemActiveClass).on(u,".km-listview-label",function(b){if(c.support.touch){var d=a(b.target).find("input"),e=!d[0].checked;d.is(":radio")&&(e=!0),d.attr("checked",e).trigger("change")}}).on(u,j,l(e._click,e)),e.element.wrap(r),e.wrapper=e.element.parent(),e._footer(),e._dataSource(),e._bindScroller(),e._fixHeaders(),d.dataSource&&e.options.autoBind?e.dataSource.fetch():e._style(),c.notify(e,f)},events:[A,z],options:{name:"ListView",style:"",type:"flat",autoBind:!0,fixedHeaders:!1,template:"#:data#",headerTemplate:'<span class="km-text">#:value#</span>',appendOnRefresh:!1,loadMore:!1,loadMoreText:"Press to load more",endlessScroll:!1,scrollTreshold:30,pullToRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",pullOffset:140},setOptions:function(a){i.fn.setOptions.call(this,a)},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),this.options.autoBind&&a.fetch()},destroy:function(){var a=this;i.fn.destroy.call(a),a._unbindDataSource(),a.stopEndlessScrolling(),a.stopLoadMore(),a.element.off(s),c.destroy(a.element)},refresh:function(b){b=b||{};var d=this,g=d.element,h=d.options,i=d.dataSource,j=i.view(),k=d.loading,l="html",m,n,o;b.action==="itemchange"?(n=b.items[0],o=a(d.template(n)),g.find("[data-"+c.ns+"uid="+n.uid+"]").replaceWith(o),d.trigger("itemChange",{item:o,data:n,ns:f}),d._style()):(d.template||d._templates(),d._cacheDataItems(j),d.trigger("dataBinding"),i.group()[0]?(h.type="group",m=c.render(d.groupTemplate,j)):m=c.render(d.template,j),k?l="append":h.appendOnRefresh&&(l="prepend"),g[l](m),k&&(d.loading=!1,d._calcTreshold(),d._toggleLoader(!1)),h.pullToRefresh&&d._scroller().pullHandled(),e.init(g.children()),d._hideLoading(),d._shouldFixHeaders(),d._style(),d.trigger("dataBound",{ns:f}))},_cacheDataItems:function(a){var b=this,c;b.element[0].firstChild||(b._firstOrigin=b._first=a[0],b._last=a[a.length-1]),b._pulled&&(c=a[0],b._pulled=!1,c&&(b._first=c)),b.loading&&(c=a[a.length-1],c&&(b._last=c))},items:function(){return this.options.type==="group"?this.element.find(".km-list").children():this.element.children()},stopEndlessScrolling:function(){var a=this,b=a._scroller();b&&a._loadIcon&&(a.loading=!1,a._loadIcon.parent().hide(),b.unbind("resize",a._scrollerResize).unbind("scroll",a._scrollerScroll),a.trigger(z))},stopLoadMore:function(){var a=this;a._loadButton&&(a.loading=!1,a._loadButton.off(B).parent().hide(),a.trigger(z))},_toggleItemActiveClass:function(b){if(!(b.which>1)){var c=a(b.currentTarget),d=c.parent(),e=m(c,"role")||"",f=!e.match(G),g=b.isDefaultPrevented();f&&d.toggleClass(o,b.type===v&&!g)}},_unbindDataSource:function(){var a=this;a.dataSource.unbind(C,a._refreshHandler).unbind(D,a._requestStartHandler)},_dataSource:function(){var a=this,b=a.options;a.dataSource&&a._refreshHandler?a._unbindDataSource():(a._refreshHandler=l(a.refresh,a),a._requestStartHandler=l(a._showLoading,a)),a.dataSource=h.create(b.dataSource).bind(C,a._refreshHandler),!b.pullToRefresh&&!b.loadMore&&!b.endlessScroll&&a.dataSource.bind(D,a._requestStartHandler)},_fixHeader:function(b){var c=0,d=this,e=d._scroller(),f=b.scrollTop,g=d.headers,h,i,j;if(d.fixedHeaders){do{h=g[c++];if(!h){j=a("<div />");break}i=h.offset,j=h.header}while(i>f);d.currentHeader!=c&&(e.fixedContainer.html(j.clone()),d.currentHeader=c)}},_shouldFixHeaders:function(){this.fixedHeaders=this.options.type==="group"&&this.options.fixedHeaders},_cacheHeaders:function(){var b=this,c=[];b.fixedHeaders&&(b.element.find("."+n).each(function(b,d){d=a(d),c.unshift({offset:d.position().top,header:d})}),b.headers=c,b._fixHeader({scrollTop:0}))},_fixHeaders:function(){var a=this,b=a._scroller();a._shouldFixHeaders(),b&&(c.onResize(function(){a._cacheHeaders()}),b.bind("scroll",function(b){a._fixHeader(b)}))},_bindScroller:function(){var a=this,b=a.options,c=a.dataSource,d=a._scroller();!d||(b.pullToRefresh&&d.setOptions({pullToRefresh:!0,pull:function(){var d=b.pullParameters,e={page:1};d&&(e=d.call(a,a._first)),a._pulled=!0,c.read(e)},pullTemplate:b.pullTemplate,releaseTemplate:b.releaseTemplate,refreshTemplate:b.refreshTemplate}),b.endlessScroll&&(a._scrollHeight=d.element.height(),a._scrollerResize=function(){a._scrollHeight=d.element.height(),a._calcTreshold()},a._scrollerScroll=function(b){!a.loading&&b.scrollTop+a._scrollHeight>a._treshold&&a._nextPage()},d.setOptions({resize:a._scrollerResize,scroll:a._scrollerScroll})))},_calcTreshold:function(){var a=this,b=a._scroller();b&&(a._treshold=b.scrollHeight()-a.options.scrollTreshold)},_nextPage:function(){var a=this,b=a.options,c=b.endlessScrollParameters||b.loadMoreParameters,d;a.loading=!0,a._toggleLoader(!0),c&&(d=c.call(a,a._firstOrigin,a._last)),a.dataSource.next(d)||(a.stopLoadMore(),a.stopEndlessScrolling())},_templates:function(){var a=this,b=a.options.template,d=a.options.headerTemplate,e=' data-uid="#=data.uid || ""#"',f={},g={};typeof b===E&&(f.template=b,b="#=this.template(data)#"),g.template=a.template=l(c.template("<li"+e+">"+b+"</li>"),f),typeof d===E&&(g._headerTemplate=d,d="#=this._headerTemplate(data)#"),g.headerTemplate=c.template(d),a.groupTemplate=l(q,g)},_click:function(b){if(!(b.which>1||b.isDefaultPrevented())){var d=this,e,g=a(b.currentTarget),h=a(b.target),i=h.closest(c.roleSelector("button","detailbutton","backbutton")),j=c.widgetInstance(i,f),k=g.attr(c.attr("uid"));k&&(e=d.dataSource.getByUid(k)),d.trigger(A,{target:h,item:g,dataItem:e,button:j})&&b.preventDefault()}},_style:function(){var b=this,c=b.options,d=c.type==="group",e=b.element,f=c.style==="inset";e.addClass("km-listview").toggleClass("km-list",!d).toggleClass("km-listinset",!d&&f).toggleClass("km-listgroup",d&&!f).toggleClass("km-listgroupinset",d&&f),d&&(e.children().children("ul").addClass("km-list"),e.children("li").each(function(){var b=a(this).contents().first();!b.is("ul")&&!b.is("div."+n)&&b.wrap(p)})),b._enhanceItems(),e.parents(".km-listview")[0]||e.closest(".km-content").toggleClass("km-insetcontent",f),b._cacheHeaders()},_enhanceItems:function(){this.items().each(function(){var b=a(this),c,d=!1;b.children().each(function(){c=a(this),c.is("a")?(K(c),d=!0):c.is("label")&&(L(c),d=!0)}),d||J(b)})},_footer:function(){var b=this,c=b.options,d=c.loadMore,e;if(d||c.endlessScroll)b._loadIcon=a('<span style="display:none" class="km-icon"></span>'),e=a('<span class="km-load-more"></span>').append(b._loadIcon),d&&(b._loadButton=a('<button class="km-load km-button">'+c.loadMoreText+"</button>").on(B,l(b._nextPage,b)),e.append(b._loadButton)),b.wrapper.append(e)},_toggleLoader:function(a){var b=this,c=b._loadIcon,d=b._loadButton;d&&d.toggle(!a),a?c.css("display","block"):c.hide()},_scroller:function(){var a=this,b;a._scrollerInstance||(b=a.view(),a._scrollerInstance=b&&b.scroller);return a._scrollerInstance},_showLoading:function(){var a=this.view();a&&a.loader.show()},_hideLoading:function(){var a=this.view();a&&a.loader.hide()}});f.plugin(M)})(jQuery);